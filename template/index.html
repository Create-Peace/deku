<div id="root"></div>
<script type="module" src="./index.js"></script>
<script type="module">
  import { getCurrentFiber, scheduleWork } from './web_modules/fre.js'
  const wsp = location.protocol === 'https:' ? 'wss' : 'ws'
  const ws = new WebSocket(`${wsp}://localhost:4000`)
  ws.onopen = () => console.log('opened.')
  ws.onmessage = (e) => {
    const { type, path, timestamp } = JSON.parse(e.data)
    if (type === 'reload') {
      import(`./a.js?t=${timestamp}`).then((mod) => {
        const fiber = mod.default.WIP
        console.log(fiber)
        const vdom = mod.default(fiber.props)
        console.log(vdom)
        scheduleWork(fiber)
      })
    }
  }

  ws.onerror = (e) => console.error(e)
  ws.onclose = (e) => console.log('closed.')
</script>
